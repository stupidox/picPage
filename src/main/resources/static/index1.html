<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>主页</title>
</head>
<body>
<div style="font-size: 23px;text-align: center"><a href="./page/pics.html" style="text-decoration: none;color: mediumblue;">看图</a></div>
</body>
<script type="text/javascript" src="js/jquery/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/all.css">
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
    function openDir() {
        const val = encode($('#dirPath').val());
        $.ajax({
            type: "GET",
            contentType: "application/json",
            url: "/comic/list",
            data: {path: val, dir: null, rootPath: val},
            dataType: 'json',
            success: function (data) {
                let res = '';
                if (data.out === '1') {
                    $('#dirPath').addClass('outSide');
                }
                for (let i = 0; i < data.data.length; i++) {
                    res += '<a class="name" href="javascript:void(0)" data-p="' + data.data[i] + '">'
                        + data.data[i] + '</a><div style="next"></div>';
                }
                $('#comicList').html(res);
                $(".name").click(function(){
                    const path = $(this).data("p")
                    $.ajax({
                        type: "GET",
                        contentType: "application/json",
                        url: "/comic/pathInfo",
                        data: {path: path},
                        dataType: 'json',
                        success: function (data1) {
                            window.location.href='/page/pics.html?path='+encode(data1.path)+'&rootPath='+val+'&dir='
                        },
                        error: function (e) {
                        }
                    });
                });
            },
            error: function (e) {
            }
        });
    }
    $(function (){
        const params = new URLSearchParams(window.location.search);
        let rootPath = params.get('rootPath');
        $('#dirPath').on('change', openDir);
        $('#dirPath').val('');
        if (rootPath != null && rootPath !== "") {
            rootPath = rootPath.replaceAll("/", "\\");
            $('#dirPath').val(rootPath);
        } else {
            $('#dirPath').val('E:\\private\\pics');
        }
        $('#dirPath').change();
    })
</script>
</html>